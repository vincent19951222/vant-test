<navigation-bar title="企业 AI 助手" back="{{false}}"></navigation-bar>

<scroll-view class="chat-container" scroll-y enable-flex scroll-with-animation>
  <view class="message-list">
    <block wx:for="{{messages}}" wx:key="index">
      
      <!-- Time -->
      <view wx:if="{{item.type === 'time'}}" class="flex justify-center mb-4">
        <text class="text-xs text-secondary bg-gray-100 px-2 py-1 rounded">{{item.content}}</text>
      </view>

      <!-- Bot Message -->
      <view wx:if="{{item.type === 'bot'}}" class="flex justify-start mb-6 fade-in-up">
        <view class="w-8 h-8 rounded-full bg-primary flex items-center justify-center text-white mr-2 shrink-0">
          <van-icon name="service" />
        </view>
        <view class="bg-white p-4 rounded-2xl rounded-tl-none shadow-sm max-w-85 border border-slate-50">
          <block wx:if="{{item.isWelcome}}">
            <view class="flex items-center gap-2 mb-2">
              <van-tag type="primary" plain>智能办公助手</van-tag>
              <van-tag type="success" plain>在线</van-tag>
            </view>
          </block>
          
          <block wx:if="{{item.isRich}}">
            <rich-text class="text-sm leading-relaxed text-slate-700" nodes="{{item.richContent}}"></rich-text>
          </block>
          <block wx:else>
            <text class="text-sm leading-relaxed text-slate-700" user-select space="ensp">{{item.content}}</text>
          </block>
          
          <block wx:if="{{item.suggestions}}">
            <view class="mt-4 pt-4 border-t border-slate-100 grid grid-cols-2 gap-2">
              <block wx:for="{{item.suggestions}}" wx:for-item="sug" wx:key="text">
                <view class="text-left p-2 bg-slate-50 rounded hover:bg-blue-50" bindtap="onQuickAction" data-action="{{sug.text}}">
                  <view class="text-xs text-secondary mb-1">{{sug.category}}</view>
                  <view class="text-sm font-medium text-slate-700">{{sug.text}}</view>
                </view>
              </block>
            </view>
          </block>

          <block wx:if="{{item.isRich}}">
             <view class="mt-3 flex items-center gap-3 border-t border-slate-50 pt-3">
                <view class="flex items-center text-xs text-secondary">
                  <van-icon name="description" class="mr-1" /> 复制
                </view>
                <view class="flex items-center text-xs text-secondary">
                   <van-icon name="good-job-o" class="mr-1" /> 有用
                </view>
             </view>
          </block>
        </view>
      </view>

      <!-- User Message -->
      <view wx:if="{{item.type === 'user'}}" class="flex justify-end mb-6 fade-in-up">
        <view class="bg-primary text-white px-5 py-3 rounded-2xl rounded-tr-none shadow-lg max-w-80">
          <text class="text-sm leading-normal" user-select>{{item.content}}</text>
        </view>
      </view>

    </block>
  </view>
</scroll-view>

<!-- Bottom Input Area -->
<view class="fixed bottom-0 left-0 w-full bg-gradient-to-t from-slate-50 via-slate-50 to-transparent z-50" style="padding-bottom: {{safeAreaBottom + 60}}px; background: linear-gradient(to top, #F5F7FA 80%, rgba(245, 247, 250, 0));">
  
  <!-- Quick Actions -->
  <scroll-view scroll-x class="whitespace-nowrap pb-3" style="width: 100%; padding-left: 16px; padding-right: 16px; margin-bottom: 8px; box-sizing: border-box;">
    <view class="flex gap-2">
      <block wx:for="{{quickActions}}" wx:key="text">
        <view class="inline-flex items-center px-3 py-1.5 bg-white/85 border border-slate-100 shadow-sm rounded-full text-xs font-medium text-slate-600 mr-2 active-scale-95 transition-transform" 
              style="backdrop-filter: blur(4px); padding: 6px 12px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);"
              bindtap="onQuickAction" data-action="{{item.text}}">
           <van-icon name="{{item.icon}}" class="mr-1" color="{{item.color}}" style="margin-right: 4px;" />
           {{item.text}}
        </view>
      </block>
    </view>
  </scroll-view>

  <view class="px-4 flex items-end gap-2" style="display: flex; flex-direction: row; width: 100%; box-sizing: border-box; border-top: 1px solid #eeeeee; padding-top: 10px;">
    <view class="flex-1 bg-white rounded-3xl shadow-input flex items-end p-1 border border-slate-100" style="min-width: 0;">
      <van-icon name="add-o" size="24px" color="#94a3b8" class="p-2 mb-1" />
      <textarea 
        class="flex-1 bg-transparent text-sm px-1 py-2" 
        placeholder="输入您的问题..." 
        value="{{inputValue}}"
        bindinput="onInput"
        auto-height
        show-confirm-bar="{{false}}"
        cursor-spacing="20"
        maxlength="500"
        disable-default-padding
        style="min-height: 24px; max-height: 100px; line-height: 24px; padding-top: 10px; padding-bottom: 10px;"
      ></textarea>
      <!-- 使用 music-o 暂时替代麦克风，因为 Vant 标准库可能没有 mic -->
      <van-icon name="music-o" size="24px" color="#94a3b8" class="p-2 mb-1" />
    </view>
    <view class="w-10 h-10 bg-primary rounded-full flex items-center justify-center shadow-lg active-scale-90 transition-all mb-1 shrink-0" bindtap="onSend" style="display: flex;">
      <van-icon name="guide-o" color="#fff" size="20px" />
    </view>
  </view>
</view>
